---
layout: default
---

<div class="post">
  <h1 class="post-title">{{ page.title }}</h1>
  <span class="post-date">{{ page.date | date_to_string }}</span>
  {{ content }}
</div>

{%- comment -%} Build list of related posts to show {%- endcomment -%}
{% assign related = "" | split: "" %}

{% for post in site.posts %}
  {% if post.url != page.url %}
    {% assign same_category = false %}
    {% assign same_tag = false %}

    {%- comment -%} Check categories {%- endcomment -%}
    {% for cat in post.categories %}
      {% if page.categories contains cat %}
        {% assign same_category = true %}
      {% endif %}
    {% endfor %}

    {%- comment -%} Check tags {%- endcomment -%}
    {% for tag in post.tags %}
      {% if page.tags contains tag %}
        {% assign same_tag = true %}
      {% endif %}
    {% endfor %}

    {%- comment -%} Keep only if both match {%- endcomment -%}
    {% if same_category and same_tag %}
      {% assign related = related | push: post %}
    {% endif %}
  {% endif %}
{% endfor %}

{% assign related = related | sort: "date" | reverse %}

<div class="related">
  <h2>Related posts</h2>
  <ul class="related-posts">

    {% if related.size > 0 %}
    {% for post in related limit:10 %}
    <li>
      <h3>
        <a href="{{ site.baseurl }}{{ post.url }}">
          {{ post.title }}
          <small>{{ post.date | date_to_string }}</small>
        </a>
      </h3>
    </li>
    {% endfor %}
    {% endif %}

    {% if page.categories.size > 0 %}
    {% assign cat = page.categories | first %}
    <li>
      <h3>
        <a href="{{ site.baseurl }}/categories/{{ cat | slugify }}/">
          All {{ cat }} posts
        </a>
      </h3>
    </li>
    {% endif %}

  </ul>
</div>
